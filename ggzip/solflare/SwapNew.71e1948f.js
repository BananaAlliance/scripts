"use strict";(self.webpackChunk_rise_wallet_solflare_extension=self.webpackChunk_rise_wallet_solflare_extension||[]).push([["SwapNew"],{"../../libs/solflare-shared/dist/features/swap/components/DisabledSwap/index.js":function(e,s,t){t.d(s,{H:function(){return a}});var r=t("../../../node_modules/react/jsx-runtime.js"),n=t("../../libs/foundation-ui/dist/index.js"),i=t("../../../node_modules/react-i18next/dist/es/useTranslation.js");const o=()=>{},a=()=>{const{t:e}=(0,i.$)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.V1P,{center:e("header_swap"),textAlign:"left"}),(0,r.jsx)(n.JHu,{overflow:!0,children:(0,r.jsx)(n.HYM,{children:(0,r.jsx)(n.VAu,{from:(0,r.jsx)(n.iot,{isLoading:!0,placeholder:"0.00",id:"fromDefault",selectedToken:{},onSelectedTokenChange:o,label:(0,r.jsx)(n.__J,{htmlFor:"fromDefault",children:e("from_swap")}),right:(0,r.jsx)(n.WOI,{children:e("swap_max")}),tokens:[]}),to:(0,r.jsx)(n.iot,{isLoading:!0,placeholder:"0.00",id:"fromDefault",selectedToken:{},onSelectedTokenChange:o,label:(0,r.jsx)(n.__J,{htmlFor:"fromDefault",children:e("to_swap")}),right:(0,r.jsx)(n.WOI,{children:e("table_balance")}),tokens:[]}),onSwapDividerClick:o,dividerButtonDisabled:!0})})}),(0,r.jsxs)(n.p4T,{children:[(0,r.jsx)(n.bZj,{message:e("swap_mainnet_alert_description"),title:e("swap_mainnet_alert_header"),variant:"info"}),(0,r.jsx)(n.zxk,{disabled:!0,children:e("action_swap")})]})]})}},"../../libs/solflare-shared/dist/features/swap/index.js":function(e,s,t){t.r(s),t.d(s,{SwapWeb:function(){return r.Q},default:function(){return n.u}});var r=t("../../libs/solflare-shared/dist/features/swap/swap/swap.web.js"),n=t("../../libs/solflare-shared/dist/features/swap/swap/swap.ext.js")},"../../libs/solflare-shared/dist/features/swap/swap/container.js":function(e,s,t){var r=t("../../../node_modules/react/jsx-runtime.js"),n=t("../../../node_modules/react/index.js"),i=t("../../../node_modules/react-router/esm/react-router.js"),o=t("../../../node_modules/react-i18next/dist/es/useTranslation.js"),a=t("../../../node_modules/bignumber.js/bignumber.js"),l=t.n(a),u=t("../../../node_modules/lodash/lodash.js"),d=t("../../../node_modules/@fortawesome/pro-light-svg-icons/index.mjs"),c=t("../../libs/foundation-ui/dist/index.js"),f=t("../../libs/shared/dist/utils/displayPrice.js"),p=t("../../libs/shared/dist/features/currencies/index.js"),m=t("../../libs/solflare-shared/dist/constants/mints.js"),h=t("../../libs/solflare-shared/dist/utils/units.js"),b=t("../../libs/solflare-shared/dist/storage/solflareService.js"),j=t("../../libs/solflare-shared/dist/features/swap/hooks/useTokensData/index.js"),k=t("../../libs/solflare-shared/dist/features/swap/hooks/useJupiterQuote/index.js"),g=t("../../libs/solflare-shared/dist/components/withWallet/index.js"),x=t("../../libs/solflare-shared/dist/features/swap/utils.js"),w=t("../../libs/solflare-shared/dist/features/swap/constants.js"),y=t("../../libs/solflare-shared/dist/features/swap/components/Table/index.js"),v=t("../../libs/solflare-shared/dist/features/swap/components/BadTradeDialog/index.js"),_=t("../../libs/solflare-shared/dist/features/swap/components/SwapSettings/index.js"),S=t("../../libs/solflare-shared/dist/features/swap/hooks/useWarningStates/index.js"),I=t("../../libs/solflare-shared/dist/utils/common.js"),C=t("../../libs/solflare-shared/dist/components/ConfirmationHelpers/ConfirmationSwap.js"),O=t("../../libs/solflare-shared/dist/wallet/index.js"),E=t("../../libs/solflare-shared/dist/features/swap/hooks/useSwapFee/index.js"),D=t("../../libs/solflare-shared/dist/features/swap/api/index.js"),M=t("../../libs/solflare-shared/dist/features/swap/hooks/useSignAndSendSwap/index.js"),Q=t("../../../node_modules/qs/lib/index.js"),T=t.n(Q),q=t("../../libs/solflare-shared/dist/features/trading/hooks/useMarketPrice/index.js");s.Z=(0,g.a)({protectedPage:!0})((()=>{const{t:e}=(0,o.$)(),s=(0,i.$B)("/portfolio/:id"),t=(0,i.TH)(),{fromCoinQuery:a,toCoinQuery:g}=(0,n.useMemo)((()=>{let e=null,s=null;const r=T().parse(t.search?.substring(1)||"");return r.from&&"string"==typeof r.from&&(e=r.from),r.to&&"string"==typeof r.to&&(s=r.to),{fromCoinQuery:e,toCoinQuery:s}}),[t]),[Q,P]=(0,n.useState)(w.k4),[B,R]=(0,n.useState)(w.k4),[A,F]=(0,n.useState)([]),[H,J]=(0,n.useState)([]),[L,Z]=(0,n.useState)(""),[$,z]=(0,n.useState)(""),[W,U]=(0,n.useState)(""),[V,K]=(0,n.useState)(null),[N,X]=(0,n.useState)(null),[Y,G]=(0,n.useState)(!1),[ee,se]=(0,n.useState)(!1),[te,re]=(0,n.useState)(w.M$.priceImpact),[ne,ie]=(0,n.useState)(!1),[oe,ae]=(0,n.useState)("swap"),[le,ue]=(0,n.useState)({value:0,label:"0"}),[de,ce]=(0,n.useState)(""),{wallet:fe,transactionInit:pe}=(0,O.we)(),{swapFee:me}=(0,E.B)(),{result:{tokens:he,isTokensLoading:be},tokensQuery:je}=(0,j.x)(),ke=(0,n.useMemo)((()=>(0,u.keyBy)(he,"tokenId")),[he]),{quote:{data:ge,dataUpdatedAt:xe,isLoading:we,refetch:ye,remove:ve,isFetching:_e,status:Se,isError:Ie,isSuccess:Ce}}=(0,k.r)({amount:L,slippageBps:le.value.toString(),inputMint:Q?.tokenId,outputMint:B.tokenId,decimals:Q?.decimals,feeBps:me.amount});(0,n.useEffect)((()=>()=>ve()),[]);const{data:Oe,refetch:Ee,isFetching:De}=(0,q.v)({inMint:Q?.tokenId,outMint:B?.tokenId}),Me=(0,n.useCallback)((()=>{ye(),Ee()}),[ye,Ee]),Qe=ge?.uiData,Te=100*(Qe?.priceImpactPct??0),qe=(0,n.useMemo)((()=>{if(Q.tokenId===m.Jb){const e=new(l())(Q.rawAmount).minus(w.RK).toString();return Math.max(+e,0)}return Q.rawAmount}),[Q.rawAmount,Q.tokenId]),{alertProps:Pe}=(0,S.v)({fromAmount:L,maxFromBalance:qe,selectedFromCoin:Q,tokens:he,hasQuoteData:!!Qe,isQuoteLoading:we,dataUpdatedAt:xe,isError:Ie}),Be=!(!Pe&&+$&&Q.tokenId&&B.tokenId&&Y),Re=(0,n.useRef)((0,u.debounce)((e=>z(e)),1e3)).current,Ae=(0,n.useRef)((0,u.debounce)((()=>Me()),500)).current,Fe=(0,n.useRef)(!0),He=(0,n.useCallback)((()=>{G(!1),Ae()}),[Ae]),Je=({type:e,coin:s})=>{if({from:Q,to:B}[e]===s)return;const t={from:P,to:R},r={from:K,to:X};G(!1),t[e](s),r[e](null)},Le=async()=>{if(!ge?.txData)return;se(!1),G(!1);const s=W.replace(/,/g,"");await pe({title:e("swap_confirmation_title"),txBuilder:D.f9,builderParams:{publicKey:fe.publicKey,data:ge.txData},commitment:"confirmed",useSignAndSend:M.j,onBroadcast:({status:e})=>{"success"===e?(Z(""),U("")):He()},onConfirm:({status:e})=>{"fail"===e&&He(),"success"===e&&(G(!1),je.refetch())},onSign:({status:e})=>{"rejected"===e&&He()},confirmDialog:(0,r.jsx)(C.Z,{fromTokenImage:Q.logoURI,fromAmountWithSymbol:(0,f.ED)({amount:L,suffix:` ${Q.symbol}`,pricePerCoin:Q.usdPrice,displayType:"solana"}),fromValueWithCurency:+Q.price>0?(0,r.jsx)(p.sp,{value:+L*+Q.price}):void 0,toTokenImage:B.logoURI,toAmountWithSymbol:(0,f.ED)({amount:s,suffix:` ${B.symbol}`,pricePerCoin:B.usdPrice,displayType:"solana"}),toValueWithCurency:+B.price>0?(0,r.jsx)(p.sp,{value:+s*+B.price}):void 0})})},Ze=(0,n.useCallback)((async({refetch:e,value:s})=>{ie(!1),e&&(L&&He(),ue({value:Math.round(100*s),label:String(s)}),await b.Z.swapSlippage.set(+s))}),[L,He]);return(0,n.useEffect)((()=>{$&&+L==+$&&+$&&B.tokenId&&Q.tokenId&&$!==L&&Me()}),[$,L]),(0,n.useEffect)((()=>{L?(B.tokenId&&L||U(""),+L&&B.tokenId&&Q.tokenId&&Me()):U("")}),[Q.tokenId,B.tokenId]),(0,n.useEffect)((()=>{if(!Ie&&Qe||U(""),Ce&&!_e&&Qe){re(null);const e=(0,h.d)(Qe.outAmount,B.decimals);U((0,f.ED)({displayType:"solana",amount:(0,I.iP)(e,B.decimals)})),G(!0);const s=new(l())(Q.usdPrice).times(L).div(B.usdPrice).toNumber(),t=Oe?.denom===Q.tokenId?new(l())(L).div(Oe?.price??0).toNumber():new(l())(L).times(Oe?.price??0).toNumber(),r=(0,I.LD)(s,t);if(ce(r.toFixed(2)),Oe&&r>=10&&Q.usdPrice>0&&B.usdPrice>0)return void re(w.M$.moreExpensive);Te>=5&&re(w.M$.priceImpact)}}),[Se,_e,De]),(0,n.useEffect)((()=>{if(he.length){const e=(0,x.pR)(he),s=(0,x.x9)(he);F((0,x.jK)(e,V||"",B.tokenId)),J((0,x.jK)(s,N||"",Q.tokenId))}}),[he,V,Q.tokenId,B.tokenId,N]),(0,n.useEffect)((()=>{if(he.length&&Fe.current){if(s){const{params:e}=s,t=he.find((s=>s.tokenId===e.id))||w.k4,r=he.find((e=>e.tokenId===m.Xz))||w.k4,n=he.find((e=>e.tokenId===m.Jb))||w.k4;return Fe.current=!1,e.id===m.BH?0==+n.amount&&+r.amount>0?(P(r),void R(n)):(P(n),void R(r)):e.id===m.Xz?+r.amount>0?(P(r),void R(n)):(P(n),void R(r)):0==+t.amount?(P(n),void R(t)):(P(t),void R(n))}if(a&&g){const e=he.find((e=>e.tokenId===a))||w.k4,s=he.find((e=>e.tokenId===g))||w.k4;return P(e),R(s),void(Fe.current=!1)}const e=(0,x.pR)(he),t=(0,x.x9)(he),r=(0,x.jK)(t,"",m.Jb),n=e.find((e=>e.tokenId===m.Jb));return F(e),J(r),P(n||w.k4),R(r[0]),void(Fe.current=!1)}if(he.length&&!Fe.current){const e=he.find((e=>e.tokenId===Q.tokenId)),s=he.find((e=>e.tokenId===B.tokenId));P(e||w.k4),R(s||w.k4)}}),[he]),(0,n.useEffect)((()=>{(async()=>{const e=await b.Z.swapSlippage.get();null===e&&await b.Z.swapSlippage.set(w.zI),ue({value:Math.round(100*(e??w.zI)),label:String(e??w.zI)})})()}),[]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.V1P,{center:e("swap_title"),textAlign:"left",right:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.Xih,{tooltipContent:s=>(0,r.jsx)("span",{children:e("swap_price_will_update_timer",{remaining:s})}),enabled:Y,countdown:w.P9,onTimeOut:He,onClick:He}),(0,r.jsx)(c.KsU,{onClick:()=>ie(!0),icon:d.cRF,size:"l"})]})}),(0,r.jsxs)(c.JHu,{overflow:!0,children:[(0,r.jsxs)(c.HYM,{children:[(0,r.jsx)(c.VAu,{from:(0,r.jsx)(c.iot,{onBlur:()=>Z((e=>""===L?"":(0,I.iP)(e,Q.decimals))),placeholder:"0",amount:L,onAmountChange:e=>{let{value:s}=e.target;s=s.trim(),s.includes(",")&&(s=s.replace(",","."));const t=(0,I.T4)(s);"."!==s&&","!==s?(t&&+s||U(""),(0,I.w9)(s,Q.decimals)&&t&&(Z(s),Re(+s),G(!1))):Z("0.")},isLoading:be,id:"fromDefault",onSearchChange:e=>K(e.target.value),selectedToken:Q,onSelectedTokenChange:e=>Je({type:"from",coin:e}),onOpenChange:e=>{e||K(null)},label:(0,r.jsx)(c.__J,{htmlFor:"fromDefault",children:e("swap_sell")}),right:(0,r.jsx)(c.WOI,{onClick:()=>{qe&&Q.tokenId&&B.tokenId&&(He(),Z(qe.toString()),$||z(qe.toString()))},children:(0,f.ED)({displayType:"solana",amount:qe||0,prefix:`${e("swap_max")}: `})}),tokens:A}),to:(0,r.jsx)(c.iot,{placeholder:"0",amount:W,id:"toDefault",readOnly:!0,isLoading:be,isLoadingAmount:(_e||!Y)&&!we&&!!L,onSearchChange:e=>X(e.target.value),onOpenChange:e=>{e||X(null)},selectedToken:B,onSelectedTokenChange:e=>Je({type:"to",coin:e}),label:(0,r.jsxs)(c.__J,{htmlFor:"toDefault",children:[e("swap_buy"),(0,r.jsx)(c.bEE,{tooltip:e("swap_buy_tooltip",{swapFee:me.percentage})})]}),right:(0,r.jsx)(c.WOI,{htmlFor:"toDefault",children:(0,f.ED)({displayType:"solana",amount:B.rawAmount||0,prefix:`${e("table_balance")}: `})}),tokens:H}),onSwapDividerClick:()=>{const e=W.replace(/,/g,"");+L&&Z((0,I.iP)(e||0,B.decimals)),G(!1),P(B),R(Q)},dividerButtonDisabled:!B.isAta||_e}),(0,r.jsx)(y.Z,{fee:me.percentage,enable:Boolean(_e||Qe&&Q.tokenId&&B.tokenId&&+L&&Ce),fromCoin:Q,toCoin:B,quote:Qe,marketPrice:Oe,coinsByMint:ke,isLoading:_e||we||!$||!Y,isMarketPriceLoading:De})]}),(0,r.jsx)(v.Z,{open:ee,variant:te,impact:(0,f.ED)({amount:Te,displayType:"amount"}),percentageDiff:de,onContinueClick:Le,onOpenChange:se})]}),(0,r.jsxs)(c.p4T,{children:[Pe&&(0,r.jsx)(c.bZj,{variant:"error",...Pe}),(0,r.jsx)(c.zxk,{onClick:()=>{te?se(!0):Le()},disabled:Be,children:e("action_swap")})]}),ne&&(0,r.jsx)(_.Z,{slippageValue:le.label,onClose:Ze})]})}))},"../../libs/solflare-shared/dist/features/swap/swap/swap.ext.js":function(e,s,t){t.d(s,{u:function(){return u}});var r=t("../../../node_modules/react/jsx-runtime.js"),n=t("../../../node_modules/react-redux/es/index.js"),i=t("../../libs/solflare-shared/dist/features/swap/swap/container.js"),o=t("../../libs/solflare-shared/dist/store/selectors/config.js"),a=t("../../libs/solflare-shared/dist/constants/networks.js"),l=t("../../libs/solflare-shared/dist/features/swap/components/DisabledSwap/index.js");const u=()=>(0,n.v9)(o.eN).cluster===a.EE.mainnet?(0,r.jsx)(i.Z,{}):(0,r.jsx)(l.H,{})},"../../../node_modules/@tanstack/react-query/build/lib/useQueries.mjs":function(e,s,t){t.d(s,{h:function(){return h}});var r=t("../../../node_modules/react/index.js"),n=t("../../../node_modules/@tanstack/react-query/build/lib/useSyncExternalStore.mjs"),i=t("../../../node_modules/@tanstack/query-core/build/lib/utils.mjs"),o=t("../../../node_modules/@tanstack/query-core/build/lib/notifyManager.mjs"),a=t("../../../node_modules/@tanstack/query-core/build/lib/queryObserver.mjs"),l=t("../../../node_modules/@tanstack/query-core/build/lib/subscribable.mjs");class u extends l.l{constructor(e,s){super(),this.client=e,this.queries=[],this.result=[],this.observers=[],this.observersMap={},s&&this.setQueries(s)}onSubscribe(){1===this.listeners.size&&this.observers.forEach((e=>{e.subscribe((s=>{this.onUpdate(e,s)}))}))}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,this.observers.forEach((e=>{e.destroy()}))}setQueries(e,s){this.queries=e,o.V.batch((()=>{const e=this.observers,t=this.findMatchingObservers(this.queries);t.forEach((e=>e.observer.setOptions(e.defaultedQueryOptions,s)));const r=t.map((e=>e.observer)),n=Object.fromEntries(r.map((e=>[e.options.queryHash,e]))),o=r.map((e=>e.getCurrentResult())),a=r.some(((s,t)=>s!==e[t]));(e.length!==r.length||a)&&(this.observers=r,this.observersMap=n,this.result=o,this.hasListeners()&&((0,i.e5)(e,r).forEach((e=>{e.destroy()})),(0,i.e5)(r,e).forEach((e=>{e.subscribe((s=>{this.onUpdate(e,s)}))})),this.notify()))}))}getCurrentResult(){return this.result}getQueries(){return this.observers.map((e=>e.getCurrentQuery()))}getObservers(){return this.observers}getOptimisticResult(e){return this.findMatchingObservers(e).map((e=>e.observer.getOptimisticResult(e.defaultedQueryOptions)))}findMatchingObservers(e){const s=this.observers,t=new Map(s.map((e=>[e.options.queryHash,e]))),r=e.map((e=>this.client.defaultQueryOptions(e))),n=r.flatMap((e=>{const s=t.get(e.queryHash);return null!=s?[{defaultedQueryOptions:e,observer:s}]:[]})),i=new Set(n.map((e=>e.defaultedQueryOptions.queryHash))),o=r.filter((e=>!i.has(e.queryHash))),l=new Set(n.map((e=>e.observer))),u=s.filter((e=>!l.has(e))),d=e=>{const s=this.client.defaultQueryOptions(e),t=this.observersMap[s.queryHash];return null!=t?t:new a.z(this.client,s)},c=o.map(((e,s)=>{if(e.keepPreviousData){const t=u[s];if(void 0!==t)return{defaultedQueryOptions:e,observer:t}}return{defaultedQueryOptions:e,observer:d(e)}}));return n.concat(c).sort(((e,s)=>r.indexOf(e.defaultedQueryOptions)-r.indexOf(s.defaultedQueryOptions)))}onUpdate(e,s){const t=this.observers.indexOf(e);-1!==t&&(this.result=(0,i.Rc)(this.result,t,s),this.notify())}notify(){o.V.batch((()=>{this.listeners.forEach((({listener:e})=>{e(this.result)}))}))}}var d=t("../../../node_modules/@tanstack/react-query/build/lib/QueryClientProvider.mjs"),c=t("../../../node_modules/@tanstack/react-query/build/lib/isRestoring.mjs"),f=t("../../../node_modules/@tanstack/react-query/build/lib/QueryErrorResetBoundary.mjs"),p=t("../../../node_modules/@tanstack/react-query/build/lib/errorBoundaryUtils.mjs"),m=t("../../../node_modules/@tanstack/react-query/build/lib/suspense.mjs");function h({queries:e,context:s}){const t=(0,d.NL)({context:s}),i=(0,c.S)(),a=(0,f._)(),l=r.useMemo((()=>e.map((e=>{const s=t.defaultQueryOptions(e);return s._optimisticResults=i?"isRestoring":"optimistic",s}))),[e,t,i]);l.forEach((e=>{(0,m.Fb)(e),(0,p.pf)(e,a)})),(0,p.JN)(a);const[h]=r.useState((()=>new u(t,l))),b=h.getOptimisticResult(l);(0,n.$)(r.useCallback((e=>i?()=>{}:h.subscribe(o.V.batchCalls(e))),[h,i]),(()=>h.getCurrentResult()),(()=>h.getCurrentResult())),r.useEffect((()=>{h.setQueries(l,{listeners:!1})}),[l,h]);const j=b.some(((e,s)=>(0,m.SB)(l[s],e,i)))?b.flatMap(((e,s)=>{const t=l[s],r=h.getObservers()[s];if(t&&r){if((0,m.SB)(t,e,i))return(0,m.j8)(t,r,a);(0,m.Z$)(e,i)&&(0,m.j8)(t,r,a)}return[]})):[];if(j.length>0)throw Promise.all(j);const k=h.getQueries(),g=b.find(((e,s)=>{var t,r;return(0,p.KJ)({result:e,errorResetBoundary:a,useErrorBoundary:null!=(t=null==(r=l[s])?void 0:r.useErrorBoundary)&&t,query:k[s]})}));if(null!=g&&g.error)throw g.error;return b}}}]);