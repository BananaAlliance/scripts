"use strict";(self.webpackChunk_rise_wallet_solflare_extension=self.webpackChunk_rise_wallet_solflare_extension||[]).push([["FcmNotificationsComponent"],{"../../../node_modules/@mui/material/Container/Container.js":function(e,t,s){s.d(t,{Z:function(){return I}});var n=s("../../../node_modules/@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js"),i=s("../../../node_modules/@babel/runtime/helpers/esm/extends.js"),a=s("../../../node_modules/react/index.js"),o=s("../../../node_modules/clsx/dist/clsx.m.js"),r=s("../../../node_modules/@mui/utils/esm/capitalize.js"),l=s("../../../node_modules/@mui/utils/esm/generateUtilityClass/generateUtilityClass.js"),d=s("../../../node_modules/@mui/utils/esm/composeClasses/composeClasses.js"),u=s("../../../node_modules/@mui/system/esm/useThemeProps/useThemeProps.js"),c=s("../../../node_modules/@mui/system/esm/styled.js"),m=s("../../../node_modules/@mui/system/esm/createTheme/createTheme.js"),p=s("../../../node_modules/react/jsx-runtime.js");const f=["className","component","disableGutters","fixed","maxWidth","classes"],g=(0,m.Z)(),h=(0,c.Z)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,t[`maxWidth${(0,r.Z)(String(s.maxWidth))}`],s.fixed&&t.fixed,s.disableGutters&&t.disableGutters]}}),b=e=>(0,u.Z)({props:e,name:"MuiContainer",defaultTheme:g});var x=s("../../../node_modules/@mui/material/utils/capitalize.js"),_=s("../../../node_modules/@mui/material/styles/styled.js"),j=s("../../../node_modules/@mui/material/styles/useThemeProps.js");const y=function(e={}){const{createStyledComponent:t=h,useThemeProps:s=b,componentName:u="MuiContainer"}=e,c=t((({theme:e,ownerState:t})=>(0,i.Z)({width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",display:"block"},!t.disableGutters&&{paddingLeft:e.spacing(2),paddingRight:e.spacing(2),[e.breakpoints.up("sm")]:{paddingLeft:e.spacing(3),paddingRight:e.spacing(3)}})),(({theme:e,ownerState:t})=>t.fixed&&Object.keys(e.breakpoints.values).reduce(((t,s)=>{const n=s,i=e.breakpoints.values[n];return 0!==i&&(t[e.breakpoints.up(n)]={maxWidth:`${i}${e.breakpoints.unit}`}),t}),{})),(({theme:e,ownerState:t})=>(0,i.Z)({},"xs"===t.maxWidth&&{[e.breakpoints.up("xs")]:{maxWidth:Math.max(e.breakpoints.values.xs,444)}},t.maxWidth&&"xs"!==t.maxWidth&&{[e.breakpoints.up(t.maxWidth)]:{maxWidth:`${e.breakpoints.values[t.maxWidth]}${e.breakpoints.unit}`}}))),m=a.forwardRef((function(e,t){const a=s(e),{className:m,component:g="div",disableGutters:h=!1,fixed:b=!1,maxWidth:x="lg"}=a,_=(0,n.Z)(a,f),j=(0,i.Z)({},a,{component:g,disableGutters:h,fixed:b,maxWidth:x}),y=((e,t)=>{const{classes:s,fixed:n,disableGutters:i,maxWidth:a}=e,o={root:["root",a&&`maxWidth${(0,r.Z)(String(a))}`,n&&"fixed",i&&"disableGutters"]};return(0,d.Z)(o,(e=>(0,l.Z)(t,e)),s)})(j,u);return(0,p.jsx)(c,(0,i.Z)({as:g,ownerState:j,className:(0,o.Z)(y.root,m),ref:t},_))}));return m}({createStyledComponent:(0,_.ZP)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,t[`maxWidth${(0,x.Z)(String(s.maxWidth))}`],s.fixed&&t.fixed,s.disableGutters&&t.disableGutters]}}),useThemeProps:e=>(0,j.Z)({props:e,name:"MuiContainer"})});var I=y},"../../libs/solflare-shared/dist/components/FcmNotifications/index.js":function(e,t,s){s.r(t);var n=s("../../../node_modules/react/jsx-runtime.js"),i=s("../../../node_modules/react/index.js"),a=s("../../../node_modules/react-i18next/dist/es/useTranslation.js"),o=s("../../../node_modules/react-redux/es/index.js"),r=s("../../../node_modules/@mui/material/Box/Box.js"),l=s("../../../node_modules/@mui/material/Container/Container.js"),d=s("../../../node_modules/@mui/material/Button/Button.js"),u=s("../../../node_modules/@mui/material/IconButton/IconButton.js"),c=s("../../../node_modules/@mui/styles/makeStyles/makeStyles.js"),m=s("../../../node_modules/@mui/icons-material/esm/Close.js"),p=s("../../libs/solflare-shared/dist/features/notifications/index.js"),f=s("../../libs/solflare-shared/dist/storage/solflareService.js"),g=s("../../libs/solflare-shared/dist/utils/notifications.js"),h=s("../../libs/solflare-shared/dist/constants/networks.js"),b=s("../../libs/solflare-shared/dist/store/selectors/config.js"),x=s("../../libs/solflare-shared/dist/store/selectors/data.js"),_=s("../../../node_modules/react-router/esm/react-router.js"),j=s("../../libs/solflare-shared/dist/features/settings/index.js"),y=s("../../libs/solflare-shared/dist/utils/extension.js"),I=s("../../libs/solflare-shared/dist/hooks/useMetamask/index.js");const k=(0,c.Z)((e=>({strip:{position:"relative",backgroundColor:e.palette.primary.light},valign:{position:"absolute",top:"50%",right:10,transform:"translateY(-50%)"},content:{display:"flex",alignItems:"center",justifyContent:"space-between",[e.breakpoints.down("md")]:{flexDirection:"column"},paddingTop:10,paddingBottom:10,color:e.palette.text.primary},text:{opacity:.5}})));t.default=()=>{const e=k(),{t:t}=(0,a.$)(),s=(0,_.k6)();(0,p.U)();const c=(0,o.v9)(b.eN),C=(0,o.v9)(x.yu),[N,w]=(0,i.useState)(!1),{isMetamask:T}=(0,I.U)(),{setNotificationsEnabled:v}=(0,p.c)({onDenied:()=>s.push(j.ln.NOTIFICATIONS.HOME)}),$=(0,i.useCallback)((async()=>{let e=await f.Z.solflareEnableNotificationsModal.get();null!==e?(e="true"===e?0:parseInt(e,10),(0===e||Date.now()>e+(0,g.vM)())&&w(!0)):w(!0)}),[]),S=!!C.enabled;(0,i.useEffect)((()=>{!(0,g.Yz)()||c.cluster!==h.EE.mainnet||S||!y.p1&&location.pathname.includes("/provider")||!y.Cy&&y.p1||$()}),[$,c.cluster,C.loading,S]);const Z=()=>{const e=Date.now();f.Z.solflareEnableNotificationsModal.set(e).then((()=>w(!1)))};return S||!N||T?null:(0,n.jsxs)(r.Z,{className:e.strip,children:[(0,n.jsxs)(l.Z,{className:e.content,children:[(0,n.jsxs)(r.Z,{children:[(0,n.jsx)(r.Z,{display:"inline",children:t("notifications_prompt_title")}),(0,n.jsx)(r.Z,{display:"inline",ml:2,className:e.text,children:t("notifications_prompt_text")})]}),(0,n.jsx)(d.Z,{type:"button",size:"small",color:"primary",onClick:()=>{v(!0),Z()},children:t("notifications_prompt_enable")})]}),(0,n.jsx)(r.Z,{className:e.valign,children:(0,n.jsx)(u.Z,{onClick:Z,size:"large",children:(0,n.jsx)(m.Z,{color:"primary"})})})]})}},"../../libs/solflare-shared/dist/features/notifications/index.js":function(e,t,s){s.d(t,{U:function(){return b},c:function(){return x}});var n=s("../../../node_modules/react/index.js"),i=s("../../../node_modules/react-redux/es/index.js"),a=s("../../../node_modules/reselect/es/index.js"),o=s("../../../node_modules/firebase/messaging/dist/index.esm.js"),r=s("../../libs/solflare-shared/dist/store/selectors/data.js"),l=s("../../libs/solflare-shared/dist/utils/notifications.js"),d=s("../../libs/solflare-shared/dist/store/selectors/config.js"),u=s("../../libs/solflare-shared/dist/constants/networks.js"),c=s("../../libs/solflare-shared/dist/utils/extension.js"),m=s("../../../node_modules/react-i18next/dist/es/useTranslation.js"),p=s("../../libs/solflare-shared/dist/store/actions/notifications.js"),f=s("../../../node_modules/firebase/app/dist/index.esm.js"),g=s("../../../node_modules/console-browserify/index.js");const h=(0,a.P1)(d.ut,(e=>{const{wallets:t,accounts:s,loggedIn:n}=e;return n?s.map((({name:e,publicKey:s})=>({name:e,publicKey:s,type:t[s].type}))):[]})),b=()=>{const{t:e,i18n:t}=(0,m.$)(),s=(0,i.I0)(),{getState:a}=(0,i.oR)(),b=(0,i.v9)(r.yu),x=(0,i.v9)(d.eN),_=(0,i.v9)(h),j=(0,n.useRef)(null),y=(0,n.useRef)(null),I=(0,n.useRef)(!1),k=x.cluster===u.EE.mainnet,C=(0,l.Yz)()&&k,N=(0,n.useCallback)((()=>{y.current&&j.current&&j.current.port.postMessage({id:`notification-permission-${Math.floor(Date.now()/2e3)}`,type:"NOTIFICATION_PERMISSION",portId:y.current})}),[]);(({enabled:e,onChange:t})=>{const s=(0,i.I0)();(0,n.useEffect)((()=>{if(!e)return;let n;return(0,f.ZF)({apiKey:"AIzaSyBnuytdyhVuSzo0qAhX5QWYu6Z2jTBPWog",authDomain:"solflare-d0638.firebaseapp.com",projectId:"solflare-d0638",storageBucket:"solflare-d0638.appspot.com",messagingSenderId:"191112318129",appId:"1:191112318129:web:a3555b4ee54f13a6efa690"}),s((0,p._R)()),"permissions"in navigator&&navigator.permissions.query({name:"notifications"}).then((e=>{n=e,e.addEventListener("change",t)})),()=>{n&&n.removeEventListener("change",t)}}),[t,s,e])})({enabled:C,onChange:N});const w=(0,n.useCallback)((async e=>{if(!j.current)return;let t=null,s=null,n="/assets/logo-128.png";e.data.icon&&(n=e.data.icon),e.data&&(["notification","broadcast","cast","event"].includes(e.data.type)&&(t=e.data.title,s={body:e.data.body,icon:n,data:e.data}),j.current.port.postMessage({type:"NOTIFICATION",notificationId:e.data.uuid??e.messageId,notificationTitle:t,notificationOptions:s,portId:y.current}))}),[]),T=(0,n.useCallback)((async()=>{if(!j.current)return;const n=h(a());if("granted"===Notification.permission){const i=(0,o.KL)(),a=await(0,o.LP)(i,{vapidKey:"BJaqqoHkXBHpbb5TjC0jks2gmd6rEfFrDu9BBk89E7IaU6bvzD6BscmDf9ryfyfsmyH-c_e0aqEwX-86UD0VHII"});if(a)return I.current||((0,o.ps)(i,w),I.current=!0),await s((0,p.HU)({language:t.language,pushToken:a,osVersion:"1",accounts:n}))||j.current.port.postMessage({type:"NOTIFICATION",notificationId:`enabled-notifications-${Math.floor(Date.now()/2e3)}`,notificationTitle:e("notifications_enabled_title"),notificationOptions:{body:e("notifications_enabled_body"),icon:"/assets/logo-128.png"},portId:y.current}),void j.current.port.postMessage({type:"NOTIFICATION_RELOAD_STATE",portId:y.current})}await s((0,p.zH)({language:t.language,keepPushToken:!0})),j.current.port.postMessage({type:"NOTIFICATION_RELOAD_STATE",portId:y.current})}),[s,a,w,t.language,e]),v=(0,n.useCallback)((e=>{"CONNECTION"===e.data.type?(y.current=e.data.portId,N()):"NOTIFICATION_PERMISSION"===e.data.type?T():"NOTIFICATION_RELOAD_STATE"===e.data.type?s((0,p.Bn)({language:t.language})):"NOTIFICATION"===e.data.type&&(new Notification(e.data.notificationTitle,e.data.notificationOptions).onclick=function(e){e.preventDefault(),e.target.close();const t=e.target.data,s=t?.publicKey;let n=null,i=null;try{if(t&&t.customPayload){const e=t.customPayload.match(/^([A-Za-z]+):(.*)$/);e&&e.length>=3&&(i=JSON.parse(e[2]),n=e[1])}}catch(e){g.log(e)}const a=c.p1?"/wallet.html#":"";let o=`${a}/portfolio`;const r=["source=notification"];let l=!c.p1&&window.location.pathname.startsWith("/provider")?"_blank":"_self";if(t&&i&&"CustomNotification"===n){const e=s?`/deeplink/${s}`:"";"dappBrowser"===i.redirect_page?(o=`${a}${e}/externallink`,r.push(`url=${encodeURIComponent(i.destination_url)}`),l="_blank"):"portfolioRoute"===i.redirect_page?o=`${a}${e}/portfolio`:"portfolioStakingRoute"===i.redirect_page?o=`${a}${e}/staking`:"tradingSwap"===i.redirect_page&&(o=`${a}${e}/swap`,i.destination_mint&&"So11111111111111111111111111111111111111112"!==i.destination_mint&&(r.push("from=So11111111111111111111111111111111111111112"),r.push(`to=${i.destination_mint}`))),i.campaign_id&&r.push(`campaign_id=${i.campaign_id}`),i.notification_id&&r.push(`notification_id=${i.notification_id}`)}else t&&s?(o=`${a}/deeplink/${s}/activity`,t.dappId&&(o=`${a}/deeplink/${s}/portfolio`,r.push(`msNotificationsCenter=${t.dappId}`))):t&&t.dappId&&(o=`${a}/portfolio`,r.push(`msNotificationsCenter=${t.dappId}`));r?.length>0&&(o+=`?${r.join("&")}`),window.open(o,l)})}),[N,s,T,t.language]);(0,n.useEffect)((()=>{if(C&&b.enabled&&null===j.current&&(!c.p1||!window.location.pathname.includes("confirm_popup.html")))return j.current=new SharedWorker("/notification-worker.js"),j.current.port.addEventListener("message",v),j.current.port.start(),()=>{j.current&&(j.current.port.removeEventListener("message",v),j.current.port.close(),j.current=null)}}),[C,v,b.enabled]),(0,n.useEffect)((()=>{j.current&&y.current&&N()}),[_,N])},x=({onDenied:e}={})=>{const t=(0,i.I0)(),{i18n:s}=(0,m.$)();return{setNotificationsEnabled:(0,n.useCallback)((async n=>{if("denied"===Notification.permission)return e?.();if("default"!==Notification.permission)await t((0,p.dh)({language:s.language,enabled:n}));else{if(c.p1&&!c.Cy)return window.open("/wallet.html#/settings/notifications?enablePush=1","_blank");"granted"===await Notification.requestPermission()&&await t((0,p.dh)({language:s.language,enabled:n}))}}),[t,s.language,e])}}}}]);